<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Self-Deployable Software</title>

	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css">
	<link rel="stylesheet" href="css/fa-svg-with-js.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/monokai.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>

	<style>
		pre code {
			font-size: 16px;
			width: 100%;
			line-height: normal;			
		}

		.nobullet ul li {
    		list-style-type: none;
		}
	</style>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<div align="left">
					<center>
						<div style="width: 100%; float:inherit" align="center">
							<h1 align="left"><span style="color:rgb(0, 225, 255)">Self-Deployable</span></h1>
							<h1 align="right"><span style="color:rgb(255, 255, 0)">Software</span></h1>
						</div>
						<br />
						Juan Medina
					</center>
				</div>
			</section>
			<section>
				<section>
					<div align="left">
						<h3><span style="color:rgb(0, 225, 255)">Hello</span>, I'm <span style="color:rgb(255, 255, 0)">Juan Medina</span></h3>
						<ul style="list-style-type: none; line-height: 1.5;">
							<li>A engineer with more than 25 years of experience.</li>
							<li>Former professional game developer.</li>
							<li>Work and live in three different countries.</li>
							<li>Since 2007 Transformation on Santander UK.</li>
							<li>Tech. Architect on Digital Channels and Payments.</li>
							<li>Author of 2 published books.</li>
							<li>Love Technology and I'm always learning.</li>
						</ul>
						<br/>
						<br/>
						<div align="right" valign="bottom">
							<small>
								<a target="_blank" href="https://twitter.com/JuanMedinaCode"><i class="fab fa-twitter"></i>@JuanMedinaCode&nbsp;</a><br />
							</small>
						</div>						
					</div>
				</section>
			</section>
			<section>
				<section>
					<center>
						<div style="width: 50%; float:inherit" align="center">
							<h1>Pipelines</h1>
							<h2 align="left">that we <span style="color:rgb(0, 255, 0)">love</span></h2>
							<h2 align="right">and <span style="color:rgb(255, 0, 0)">hate</span></h2>
						</div>
					</center>
				</section>
				<section>
					<h1>Pipelines</h1>
					<div align="left">
						<ul>
							<li>Great for CI/CD.</li>
							<li>Certainty and assertions.</li>
							<li>Multiple inputs for a single objective.</li>
							<li>We do not have a pipeline, for our pipeline.</li>
							<li>Fragile, they easily break.</li>
							<li>Hard to share or reuse.</li>
							<li>Duplications and repetition.</li>

						</ul>
						<br />
						<br />
						Maybe we could do something slightly different.
					</div>
				</section>
			</section>
			<section>
				<section>
					<center>
						<div style="width: 80%; float:inherit" align="center">
							<h1>Theory</h1>
							<h2 align="left">make <span style="color:rgb(0, 225, 255)">software</span> that</h2>
							<h2 align="right">can <span style="color:rgb(255, 255, 0)">deploy itself</span></h2>
						</div>
					</center>
				</section>
				<section>
					<i style="font-style: italic;">Some of the common problems derived from pipelines should improve,
						even disappear, with self
						deployable software.</i style="font-style: italic;">
				</section>
				<section>
					<h2>Self-deployable software</h2>
					<div align="left">
						<ul>
							<li>Without any CI/CD system.</li>
							<li>Becomes the pipeline.</li>
							<li>Context-aware.</li>
							<li>Auto configurable.</li>
							<li>Build with the rest of our application.</li>
							<li>As pure software, benefits from software practices.</li>
						</ul><br />
						<br />
						Like any theory, this could get validated or refuted.
					</div>
				</section>
			</section>
			<section style="width: 100%">
				<section>
					<center>
						<div style="width: 60%; float:inherit" align="center">
							<h1>Creating</h1>
							<h2 align="left">an <span style="color:rgb(0, 225, 255)">experiment</span></h2>
							<h2 align="right">deployed in <span style="color:rgb(255, 255, 0)">K8s</span></h2>
						</div>
					</center>
				</section>
				<section>
					Single end-point service : <br />
					/random<br />
					Returns a random number.<br />
					<br />
					Deployed in Pod with a set of replicas in K8s.<br />
					<br />
					User Request : <br />
					K8s > Service [choose] > Pod [random generator]<br />
				</section>
			</section>
			<section style="width: 100%">
				<section>
					<center>
						<div style="width: 60%; float:inherit" align="center">
							<h1>Designing</h1>
							<h2 align="left">a <span style="color:rgb(0, 225, 255)">kubernetes</span></h2>
							<h2 align="right">naive <span style="color:rgb(255, 255, 0)">deployment</span></h2>
						</div>
					</center>
				</section>
				<section>
					Our Deployment Strategy
					<img style="width: 60%;" src="img/deployment_approach.png" />
				</section>
			</section>
			<section>
				<section>
					<center>
						<div style="width: 80%; float:inherit" align="center">
							<h1>Demo</h1>
							<h2 align="left">our <span style="color:rgb(0, 225, 255)">self-deployable</span></h2>
							<h2 align="right"><span style="color:rgb(255, 255, 0)">software</span> into k8s</h2>
						</div>
					</center>
				</section>
				<section>
					<h3>We will need</h3>
					<br />
					<div align="left">
						<ul>
							<li>Go 1.13+</li>
							<li>A HTTP client such HTTPie</li>
							<li>A kubernetes Cluster such MicroK8s or minikube</li>
							<li>Kubectl configured</li>
							<li>Docker-ce client</li>
							<li>A docker registry</li>
						</ul>
					</div>
				</section>
				<section style="width: 100%">
					<small>Test, Build & Run</small>
					<pre style="width: 100%"><code class="bash" data-trim >

$ git clone https://github.com/juan-medina/self-deploy.git

$ cd self-deploy

$ go test -v
=== RUN   TestRandom
--- PASS: TestRandom (0.00s)
=== RUN   TestNotFound
--- PASS: TestNotFound (0.00s)
PASS
ok  	github.com/jamedina/self-deploy	0.004s

$ go build

$ ./self-deploy
2020/01/05 20:47:49 starting server on port 5000
					</code></pre>
				</section>
				<section style="width: 100%">
					<small>Testing with HTTPie</small>
					<pre style="width: 100%"><code class="bash" data-trim >
$ http :5000/random
HTTP/1.1 200 OK
Content-Length: 19
Content-Type: text/plain; charset=utf-8
Date: Sun, 05 Jan 2020 20:54:45 GMT

5577006791947779410

$ http :5000/random
HTTP/1.1 200 OK
Content-Length: 19
Content-Type: text/plain; charset=utf-8
Date: Sun, 05 Jan 2020 21:03:41 GMT

8674665223082153551
					</code></pre>
				</section>
				<section style="width: 100%">
					<small>Deploying our software</small>
					<pre style="width: 100%"><code class="bash" data-trim >
$ ./self-deploy -deploy
2020/01/06 00:19:37 starting deployment...
2020/01/06 00:19:37 creating new job...
2020/01/06 00:19:37 building docker localhost:32000/self-deploy-job:0.0.1...
2020/01/06 00:19:39 docker localhost:32000/self-deploy-job:0.0.1 built
2020/01/06 00:19:39 pushing docker image localhost:32000/self-deploy-job ...
2020/01/06 00:19:39 docker for image localhost:32000/self-deploy-job pushed
2020/01/06 00:19:39 getting k8s client..
2020/01/06 00:19:39 got k8s client
2020/01/06 00:19:39 job created
2020/01/06 00:19:39 deployment completed
					</code></pre>
				</section>
				<section style="width: 100%">
					<small>Get everything in our cluster</small>
					<pre style="width: 100%"><code class="bash" data-trim >
						$ kubectl get all
NAME                                 READY   STATUS      RESTARTS   AGE
pod/self-deploy-86cb47fc7-h6x4m      1/1     Running     0          113s
pod/self-deploy-job-job6qbvl-5zcm9   0/1     Completed   0          95m
pod/self-deploy-job-jobz5t6b-cj7hf   0/1     Completed   0          2m15s

NAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
service/kubernetes    ClusterIP   10.152.183.1     &lt;none&gt;        443/TCP    21h
service/self-deploy   ClusterIP   10.152.183.222   &lt;none&gt;        8080/TCP   113s

NAME                          READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/self-deploy   1/1     1            1           113s

NAME                                    DESIRED   CURRENT   READY   AGE
replicaset.apps/self-deploy-86cb47fc7   1         1         1       113s

NAME                                 COMPLETIONS   DURATION   AGE
job.batch/self-deploy-job-job6qbvl   1/1           1s         95m
job.batch/self-deploy-job-jobz5t6b   1/1           22s        2m15s
					</code></pre>
				</section>
				<section style="width: 100%">
					<small>get the log for our job</small>
					<pre style="width: 100%"><code class="bash" data-trim >
$ kubectl logs job.batch/self-deploy-job-jobz5t6b
2020/01/06 00:19:40 starting deployment...
2020/01/06 00:19:40 cloning from git https://github.com/juan-medina/self-deploy.git...
2020/01/06 00:19:41 cloning done
2020/01/06 00:19:41 executing tests
2020/01/06 00:19:57 go: downloading k8s.io/apimachinery v0.17.0
go: downloading k8s.io/api v0.17.0
go: downloading ....
=== RUN   TestRandom
--- PASS: TestRandom (0.00s)
=== RUN   TestNotFound
--- PASS: TestNotFound (0.00s)
PASS
ok  	github.com/jamedina/self-deploy	0.004s
2020/01/06 00:19:57 test done
2020/01/06 00:19:57 building software
2020/01/06 00:19:58 software built
2020/01/06 00:19:58 building docker localhost:32000/self-deploy:0.0.1...
2020/01/06 00:19:59 docker localhost:32000/self-deploy:0.0.1 built
2020/01/06 00:19:59 pushing docker image localhost:32000/self-deploy ...
2020/01/06 00:20:01 docker for image localhost:32000/self-deploy pushed
2020/01/06 00:20:01 deploying into k8s ...
2020/01/06 00:20:01 getting k8s client..
2020/01/06 00:20:01 got k8s client
2020/01/06 00:20:01 deployment does not exist
2020/01/06 00:20:01 creating deployment ...
2020/01/06 00:20:01 deployment created
2020/01/06 00:20:01 deployment into k8s completed
2020/01/06 00:20:01 service does not exist
2020/01/06 00:20:01 creating service ...
2020/01/06 00:20:01 service created
2020/01/06 00:20:01 deployment completed
					</code></pre>
				</section>
				<section style="width: 100%">
					<small>Get the ip of our service</small>
					<pre style="width: 100%"><code class="bash" data-trim >
$ kubectl get svc/self-deploy -o jsonpath='{.spec.clusterIP}'
10.152.183.222
					</code></pre>
				</section>
				<section style="width: 100%">
					<small>Testing our service with HTTPie</small>
					<pre style="width: 100%"><code class="bash" data-trim >
						$ http 10.152.183.222:8080/random
						HTTP/1.1 200 OK
						Content-Length: 19
						Content-Type: text/plain; charset=utf-8
						Date: Mon, 06 Jan 2020 00:28:48 GMT

						5577006791947779410

						$ http 10.152.183.222:8080/random
						HTTP/1.1 200 OK
						Content-Length: 19
						Content-Type: text/plain; charset=utf-8
						Date: Mon, 06 Jan 2020 00:28:49 GMT

						8674665223082153551
					</code></pre>
				</section>
			</section>
			<section>
				<section>
					<center>
						<div style="width: 80%; float:inherit" align="center">
							<h1>Conclusions</h1>
							<h2 align="left">What was <span style="color:rgb(0, 255, 0)">ok</span></h2>
							<h2 align="right">and what<span style="color:rgb(255, 0, 0)"> wasn't</span></h2>
						</div>
					</center>
				</section>
				<section style="width: 100%">
					<h3>What was ok</h3>
					<br />
					<div align="left">
						<ul>
							<li>We have a cohesive application</li>
							<li>We could use any software development practices</li>
							<li>We do not require any CI/CD tools</li>
							<li>Our deployment is context-aware</li>
							<li>We haven't used Yaml</li>
							<li>Linked application and deployment changes</li>
						</ul>
					</div>
				</section>
				<section style="width: 100%">
					<h3>What wasn't ok</h3>
					<br />
					<div align="left">
						<ul>
							<li>We have a lot of low-level code</li>
							<li>We may add some security risks</li>
							<li>Too complex for something simple</li>
						</ul>
					</div>
				</section>
				<section style="width: 100%">
					<h3>What we haven't done, in this iteration</h3>
					<br />
					<div align="left">
						<ul>
							<li>Kibana build monitor</li>
							<li>Use modules for git and docker</li>
							<li>Create reusable modules</li>
							<li>Webhook for git changes</li>
						</ul>
					</div>
				</section>
				<section style="width: 100%">
					<h3>Is the theory validated?</h3>
					<br />
					Maybe, we haven't got enough data
				</section>
			</section>
			<section>
				<section>
					<center>
						<div style="width: 50%; float:inherit" align="center">
							<h1>Shall We</h1>
							<h2 align="left"><span style="color:rgb(0, 225, 255)">Review</span> the</h2>
							<h2 align="right">the <span style="color:rgb(255, 255, 0)">Code</span>?</h2>
						</div>
						<br />
						<a target="_blank" href="https://github.com/juan-medina/self-deploy"><i
								class="fab fa-github"></i>&nbsp;https://github.com/juan-medina/self-deploy
						</a>
					</center>
				</section>
			</section>			
			<section>
				<section>
					<center>
						<div style="width: 60%; float:inherit" align="center">
							<h1>Thank You</h1>
							<h2 align="left">now <span style="color:rgb(0, 225, 255)">Questions</span></h2>
							<h2 align="right">and <span style="color:rgb(255, 255, 0)">Answers</span></h2>
						</div>
						<br />
						<a target="_blank" href="https://juan-medina.github.io/self-deploy"><i
								class="fas fa-desktop"></i>&nbsp;https://juan-medina.github.io/self-deploy
						</a>
					</center>
				</section>
			</section>
		</div>
	</div>

	<script src="js/reveal.js"></script>
	<script src="js/fontawesome-all.min.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({

			// Push each slide change to the browser history
			history: true,

			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true }
			]
		});
	</script>
</body>

</html>